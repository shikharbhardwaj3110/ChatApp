<html>
    <head>
    <title>Chat App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {margin: 0px; padding: 0px;}
        #mainbar {background-color: royalblue ; position: "sticky"; top: 0;}
        #chatstart {font-size: 18px; color : #9e9e9e;}
        #chatstartdiv {text-align: center; padding-top:25px;}
        #msgdiv {background-color: white; padding : 10; padding-bottom: 45px; padding-top: 20px;}
        #inputdiv {border: none ;flex:1; position: fixed; bottom : 0px; display: flex; overflow : "hidden"; width: 100%;}
        #inputtext {flex : 10; height: 45px; border-radius: 10px; border : 1px solid gray; border-bottom: 2px solid gray;}
        #button {flex : 1; border-radius: 10px; float: right; background-color :royalblue; border : 1px solid darkblue}
        
    </style>
    </head>

    <body>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            var socket = io();  
            socket.on('miscmsg',(data)=>{
                console.log(data)
            })
                        
            var lastSender = "fresh"

            timeNow = (date) => {
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var ampm = hours >= 12 ? 'pm' : 'am';
            hours = hours % 12;
            hours = hours ? hours : 12;
            minutes = minutes < 10 ? '0'+minutes : minutes;
            var strTime = hours + ':' + minutes + ' ' + ampm;
            return "Sent at " + strTime;
            }

           
            buildCard = (message,flag) => {

                var card = document.createElement('div')
                var cardContent = document.createElement('span')
                cardContent.textContent = message
                cardContent.style.fontSize = "17px"
                
                card.appendChild(cardContent)
                
                card.style.width =  "fit-content"
                card.style.maxWidth = "60%"
                card.style.borderRadius = "10px"

                
               
                var outerCard = document.createElement('div')
                var outerCardText = document.createElement('span')
                var outerCardTextDiv = document.createElement('div')
                outerCardTextDiv.appendChild(outerCardText)
                //outerCardTextDiv.style.border = "1px solid black"
                //outerCardText.style.marginBottom = "10px"
                
                //outerCardText.textContent = "You"
                console.log(lastSender)

                if(flag)
                {

                outerCardTextDiv.style.paddingRight = "10px"
                outerCardTextDiv.style.textAlign = "right"
                card.style.marginLeft = "auto"
               
                cardContent.style.color = "black"
                //outerCardText.textContent = "You"
                
                if(lastSender=="fresh" || lastSender=="Stranger")
                {
                    outerCardTextDiv.style.paddingBottom = "10px"
                    outerCardText.textContent = "You"
                    lastSender = "You"
                }
                }
                else{
                    outerCardTextDiv.style.paddingLeft = "10px"
                    outerCardTextDiv.style.textAlign = "left"
                    if(lastSender=="You" || lastSender=="fresh"){
                        outerCardText.textContent = "Stranger"
                        outerCardTextDiv.style.paddingBottom = "10px"
                    }
                    
                }
                
                card.style.paddingLeft = "8px"
                card.style.paddingRight = "8px"
                card.style.paddingBottom = "3px"
                card.style.paddingTop = "3px"
               
                card.style.border = "1px solid black"
                card.style.wordWrap = "break-word"
              
                card.appendChild(document.createElement("br"))
                var timeStamp = document.createElement('span')
                timeStamp.textContent = timeNow(new Date)
                timeStamp.style.fontSize = "12px"
                timeStamp.style.display = "block"
                timeStamp.style.marginTop = "10px"
                timeStamp.style.color = "gray"
                card.appendChild(timeStamp)
                //outerCardText.style.marginLeft = "auto"
                //outerCardText.style.marginRight = "0"
                outerCard.appendChild(outerCardTextDiv)
                outerCard.appendChild(card)
                outerCard.style.paddingBottom = "10px"
                //outerCard.style.border = "1px solid black"


                return outerCard
            }

            sendmsg = () => {
                var inputValue = document.getElementById("inputtext").value
                var messages = document.getElementById("msgdiv")
                
                if(inputValue)
                {
                    socket.emit('chat msg',inputValue)
                    var item = buildCard(inputValue,1)
                    lastSender = "You"
                    document.getElementById("inputtext").value=""
                    messages.appendChild(item)
                    //messages.appendChild(document.createElement("br"))
                }
            }

            socket.on('chat msg',(data)=>{
                var messages = document.getElementById("msgdiv")
                
                var item = buildCard(data,0)
                lastSender = "Stranger"
                //item.textContent = data
                //item.setAttribute('margin','5px')
                messages.appendChild(item)
               // messages.appendChild(document.createElement("br"))
                window.scrollTo(0, document.body.scrollHeight);
                //console.log("Msg recvd from user : ",data)
            })
            
            document.addEventListener('keypress',(e)=>{
                var input = document.getElementById("inputtext")
                if(e.key=='Enter' && input.value!=null){
                    sendmsg()
                }
            })

            socket.on('message',(data)=>{
            console.log(data)

          })
        </script>
        <div id="maindiv"></div>
        <div id="mainbar">
            <span>NavBar</span>
        </div>
        <div id="chatstartdiv">
            <span id="chatstart">Your chat starts here</span>
        </div>
        <div id="msgdiv">
        <span id="messages"></ul>
        </div>
        <div id="inputdiv">
        <input name="inputtext" id="inputtext"/><button id="button" onclick="sendmsg()">Send</button>
        </div>
    </body>
</html>